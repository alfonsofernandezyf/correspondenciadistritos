<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Consulta de Distritos</title>

  <!-- Bootstrap 5 -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

  <!-- DataTables 1.13.8 + Bootstrap 5 + Responsive -->
  <link rel="stylesheet"
        href="https://cdn.datatables.net/1.13.8/css/dataTables.bootstrap5.min.css">
  <link rel="stylesheet"
        href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap5.min.css">
</head>
<body class="bg-light">

  <div class="container py-4">
    <h1 class="text-center mb-3">Consulta de Distritos</h1>

    <p class="lead">
      Filtra por <strong>alcaldía</strong>, <strong>distrito federal</strong> o
      <strong>distrito local</strong>, o usa el buscador global (arriba a la derecha).
      Haz clic en <em>Ver PDF</em> para abrir el archivo correspondiente.
    </p>

    <!-- Filtros -->
    <div class="row g-3 mb-3">
      <div class="col-sm-6 col-md-4 col-lg-3">
        <label for="filtroAlcaldia" class="form-label mb-1">Alcaldía</label>
        <select id="filtroAlcaldia" class="form-select">
          <option value="">Todas</option>
        </select>
      </div>

      <div class="col-sm-6 col-md-4 col-lg-3">
        <label for="filtroDistritoFed" class="form-label mb-1">Distrito federal</label>
        <select id="filtroDistritoFed" class="form-select">
          <option value="">Todos</option>
        </select>
      </div>

      <div class="col-sm-6 col-md-4 col-lg-3">
        <label for="filtroDistritoLoc" class="form-label mb-1">Distrito local</label>
        <select id="filtroDistritoLoc" class="form-select">
          <option value="">Todos</option>
        </select>
      </div>
    </div>

    <!-- Tabla -->
    <table id="tablaDistritos"
           class="table table-striped table-bordered nowrap w-100"></table>
  </div>

  <!-- JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap5.min.js"></script>

  <script>
    let dt; // referencia global a DataTable

    fetch('distritos.json')
      .then(r => r.json())
      .then(crearTabla)
      .catch(err => console.error('No se pudo leer distritos.json', err));

    function crearTabla(data) {
      dt = $('#tablaDistritos').DataTable({
        data,
        columns: [
          { title: 'Sección',          data: 'SECCIÓN' },
          { title: 'Alcaldía',         data: 'DEMARCACIÓN TERRITORIAL' },
          { title: 'Distrito Federal', data: 'DISTRITO JUDICIAL ELECTORAL FEDERAL' },
          { title: 'PDF Federal',      data: 'ArchivoJudicial', render: linkPDF },
          { title: 'Distrito Local',   data: 'DISTRITO JUDICIAL ELECTORAL LOCAL' },
          { title: 'PDF Local',        data: 'ArchivoLocal',    render: linkPDF }
        ],
        responsive: true,
        pageLength: 25,
        language: { url:'https://cdn.datatables.net/plug-ins/1.13.8/i18n/es-MX.json' }
      });

      poblarSelect('#filtroAlcaldia',    1); // Alcaldía
      poblarSelect('#filtroDistritoFed', 2); // Distrito federal
      poblarSelect('#filtroDistritoLoc', 4); // Distrito local
    }

    // Rellena un <select> con valores únicos de la columna indicada
    function poblarSelect(selector, colIdx) {
      const valores = [...new Set(
        dt.column(colIdx).data().toArray().map(v => String(v).trim())
      )].sort((a, b) => a.localeCompare(b, 'es', {numeric:true}));

      const select = document.querySelector(selector);
      valores.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        select.appendChild(opt);
      });

      // Filtra al cambiar
      select.addEventListener('change', e => {
        const val = $.fn.dataTable.util.escapeRegex(e.target.value);
        dt.column(colIdx)
          .search(val ? '^' + val + '$' : '', true, false) // coincidencia exacta
          .draw();
      });
    }

    // Botón para abrir PDF
    function linkPDF(nombre) {
      return nombre
        ? `<a class="btn btn-sm btn-primary"
               href="pdfs/${encodeURIComponent(nombre)}"
               target="_blank" rel="noopener">Ver PDF</a>`
        : '';
    }
  </script>
</body>
</html>
